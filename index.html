<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>It's a Drag â€“ Braking Distance Simulation</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f6f8;
      margin: 0;
      padding: 20px;
    }

    h1 {
      text-align: center;
    }

    .controls {
      display: flex;
      justify-content: center;
      gap: 10px;
      max-width: 700px;
      margin: 20px auto;
    }

    .controls label {
      font-weight: bold;
    }

    select, input {
      width: 100%;
      padding: 6px;
    }

    .speedometer {
      width: 150px;
      height: 150px;
      margin: 20px auto;
      background: linear-gradient(135deg, #2c3e50, #34495e);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
      border: 8px solid #1a252f;
    }

    .speed-display {
      text-align: center;
      color: #00ff00;
      font-weight: bold;
    }

    #speedValue {
      font-size: 48px;
      line-height: 1;
    }

    .speed-label {
      font-size: 14px;
      color: #7fdbff;
      margin-top: 5px;
    }

    .track {
      position: relative;
      height: 80px;
      background: #ddd;
      margin: 30px auto;
      max-width: 800px;
      border-radius: 8px;
      overflow: hidden;
    }

    .car {
      position: absolute;
      top: 20px;
      left: 0;
      width: 60px;
      height: 40px;
      background: red;
      border-radius: 5px;
    }

    .light {
      width: 30px;
      height: 30px;
      background: green;
      border-radius: 50%;
      margin: auto;
    }

    .buttons {
      text-align: center;
      margin: 15px;
    }

    button {
      padding: 10px 20px;
      margin: 5px;
      font-size: 16px;
    }

    table {
      margin: auto;
      border-collapse: collapse;
      width: 400px;
    }

    td, th {
      border: 1px solid #999;
      padding: 8px;
      text-align: center;
    }

    th {
      background: #e0e0e0;
    }
  </style>
</head>

<body>

<h1>ðŸš— It's a Drag â€“ Braking Distance Simulation</h1>

<div class="controls">
  <div>
    <label>Road Surface</label>
    <select id="road">
      <option value="0.9">Concrete</option>
      <option value="0.8">Asphalt</option>
      <option value="0.6">Paver Tiles</option>
      <option value="0.4">Polished Granite</option>
    </select>
  </div>
</div>

<div class="speedometer">
  <div class="speed-display">
    <div id="speedValue">0</div>
    <div class="speed-label">km/h</div>
  </div>
</div>

<div class="buttons">
  <div class="light" id="light"></div><br>
  <button onclick="startTest()">Start</button>
  <button onclick="resetSim()">Reset</button>
</div>

<div class="track">
  <div class="car" id="car"></div>
</div>

<table>
  <tr>
    <th>Braking Distance (m)</th>
    <th>Total Distance Travelled (m)</th>
  </tr>
  <tr>
    <td id="brakingDist">â€“</td>
    <td id="totalDist">â€“</td>
  </tr>
</table>

<script>
  let currentSpeed = 0;
  let moving = false;
  let animation;
  let speedInterval;
  let braking = false;
  let carPosition = 0;
  let accelerationDistance = 0;
  
  const car = document.getElementById("car");
  const light = document.getElementById("light");
  const speedDisplay = document.getElementById("speedValue");

  function startTest() {
    resetSim();
    light.style.background = "green";
    moving = true;
    currentSpeed = 0;
    braking = false;
    carPosition = 0;
    accelerationDistance = 0;

    // Accelerate to 50 km/h
    speedInterval = setInterval(() => {
      if (currentSpeed < 50 && !braking) {
        currentSpeed += 2;
        if (currentSpeed > 50) currentSpeed = 50;
        speedDisplay.innerText = Math.round(currentSpeed);
        
        // Calculate distance during acceleration (using average speed)
        const speedMs = currentSpeed / 3.6;
        accelerationDistance += speedMs * 0.1; // 0.1 seconds per interval
        
        // Auto-brake when reaching 50 km/h
        if (currentSpeed >= 50) {
          applyBrakes();
        }
      }
    }, 100);

    animation = setInterval(moveCar, 20);
  }

  function applyBrakes() {
    if (braking) return;
    
    braking = true;
    light.style.background = "red";
    clearInterval(speedInterval);

    const road = parseFloat(document.getElementById("road").value);
    
    // Add variation: random factor between 0.85 and 1.15 (Â±15% variation)
    const variation = 0.85 + Math.random() * 0.3;
    const friction = road * variation;

    const speed = 50 / 3.6; // Convert to m/s

    // Calculate braking distance using physics formula
    const brakingDistance = (speed * speed) / (2 * friction * 9.8);
    
    // Total distance is acceleration distance + braking distance
    const totalDistanceTravelled = accelerationDistance + brakingDistance;

    // Decelerate the car
    const decelInterval = setInterval(() => {
      if (currentSpeed > 0) {
        currentSpeed -= 3;
        if (currentSpeed < 0) currentSpeed = 0;
        speedDisplay.innerText = Math.round(currentSpeed);
      } else {
        clearInterval(decelInterval);
        moving = false;
        clearInterval(animation);
        
        // Display results
        document.getElementById("brakingDist").innerText = brakingDistance.toFixed(2);
        document.getElementById("totalDist").innerText = totalDistanceTravelled.toFixed(2);
      }
    }, 100);
  }

  function moveCar() {
    if (moving && !braking) {
      carPosition += 2;
      car.style.left = carPosition + "px";
    } else if (braking && currentSpeed > 0) {
      // Slow down movement during braking
      carPosition += (currentSpeed / 50) * 2;
      car.style.left = carPosition + "px";
    }
  }

  function resetSim() {
    clearInterval(animation);
    clearInterval(speedInterval);
    car.style.left = "0px";
    carPosition = 0;
    accelerationDistance = 0;
    light.style.background = "green";
    moving = false;
    braking = false;
    currentSpeed = 0;
    speedDisplay.innerText = "0";

    document.getElementById("brakingDist").innerText = "â€“";
    document.getElementById("totalDist").innerText = "â€“";
  }
</script>

</body>
</html>
